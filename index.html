<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV 描述性統計分析 (DuckDB-Wasm)</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@duckdb/duckdb-wasm/dist/duckdb-wasm.js"></script>
<script>
  const duckdb = window.duckdbWasm || window.duckdb;  
  const JSDELIVR_BUNDLES = duckdb.getJsDelivrBundles();  
  const bundle          = await duckdb.selectBundle(JSDELIVR_BUNDLES);
  const workerUrl = URL.createObjectURL(
    new Blob([`importScripts("${bundle.mainWorker}")`], {type:'text/javascript'})
  );
  const worker = new Worker(workerUrl);
  const logger = new duckdb.ConsoleLogger();
  const db     = new duckdb.AsyncDuckDB(logger, worker);
  await db.instantiate(bundle.mainModule, bundle.pthreadWorker);
</script>
</head>
<body>
    <header>
        <h1>📊 CSV 描述性統計分析 (瀏覽器端)</h1>
        <p>使用 <a href="https://duckdb.org/docs/api/wasm/overview" target="_blank" rel="noopener noreferrer">DuckDB-Wasm</a> 直接在您的瀏覽器中分析 CSV 檔案，無需上傳到伺服器。</p>
    </header>

    <main>
        <section id="upload-section">
            <label for="csvFileInput">選擇一個 CSV 檔案:</label>
            <input type="file" id="csvFileInput" accept=".csv">
            <div id="status">請選擇檔案以開始分析。</div>
        </section>

        <section id="results-section" style="display: none;">
            <h2>分析結果</h2>

            <div id="schema-output">
                <h3>推斷的表格結構</h3>
                <div id="schema-table-container">載入中...</div>
            </div>

            <div id="stats-output">
                <h3>描述性統計摘要</h3>
                <div id="stats-table-container">計算中...</div>
                <button id="downloadButton" style="display: none;">📥 下載統計結果 (CSV)</button>
            </div>
        </section>
    </main>

    <footer>
        <p>Powered by DuckDB-Wasm</p>
    </footer>

    <!-- Main JavaScript Logic -->
    <script type="module" src="script.js"></script>
</body>
</html>
